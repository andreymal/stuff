# pixel_battle

Набор скриптов, который периодически используется для сохранения состояния
доски и сборки таймлапса VK Pixel Battle.

Готовые таймлапсы [2017-10-10](http://telegra.ph/Polnaya-istoriya-pervoj-pikselnoj-vojny-VKontakte-10-13):

*  [Полный (12 минут, 110МБ)](https://andreymal.org/files/pixel_battle/timelapse.mp4)
*  [Быстрый (17 секунд, 25МБ)](https://andreymal.org/files/pixel_battle/timelapse_fast.mp4)

(Видео закодировано в Lossless H.264, так что его воспроизведёт далеко не любой
плеер и уж тем более не браузер)

Скрипты:

* `pixel_battle.py` — непосредственно сам сборщик. Скачивает картинку
  по адресу `http://pixel.vkforms.ru/data/1.bmp` каждые несколько секунд/минут
  и сохраняет как оптимизированный PNG в указанный каталог (для примера `img`).

* `img2video_prepare.py` — собирает скачанные предыдущим скриптом картинки из
  каталога `img`, пририсовывает снизу дату (берёт из имени файла) и сохраняет
  в указанный каталог, создавая ffconcat-плейлист, который потом можно скормить
  в ffmpeg. Пример: `python ./img2video_prepare.py img my/src`

* `make_timelapse.sh` и `make_fast_timelapse.sh` — с помощью ffmpeg собирают
  кадры из `my/src` в H.264 lossless видео `timelapse.mp4` и
  `timelapse_fast.mp4` соответственно (на самом деле не совсем lossless,
  так как при конвертировании RGB→YUV некоторые цвета портятся без возможности
  точного восстановления RGB-значения, но вроде бы не критично: в 2017 году
  таких битых кадров меньше процента от их общего числа).

* `make_preview.sh` принимает `begin` и `end` (можно указать пустые строки
  в кавычках) и создаёт сжатый видеофайл `preview.mp4`, который потом можно
  закинуть в какой-нибудь телеграм.

* `last.html` отдаёт самую свежую картинку, сохранённую первым скриптом.
  (Осторожно, лютейший тяп-ляп и jQuery внутри)
